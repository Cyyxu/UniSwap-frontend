# 购物车接口文档

## 概述

购物车模块用于管理用户的购物车商品，支持添加、删除、更新数量、选中状态等操作。

**基础路径**: `/api/cart`

**认证方式**: 所有接口需要在请求头中携带 `Authorization: Bearer <token>`

---

## 数据模型

### CartItem（购物车项）

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | Long | 是 | 购物车项ID（主键） |
| userId | Long | 是 | 用户ID |
| commodityId | Long | 是 | 商品ID |
| commodityName | String | 是 | 商品名称（冗余存储，方便展示） |
| commodityAvatar | String | 否 | 商品图片URL |
| price | BigDecimal | 是 | 商品单价（加入时的价格） |
| quantity | Integer | 是 | 数量，默认1 |
| selected | Boolean | 是 | 是否选中，默认true |
| createTime | DateTime | 是 | 创建时间 |
| updateTime | DateTime | 是 | 更新时间 |

---

## 接口列表

### 1. 获取购物车列表

获取当前登录用户的购物车商品列表。

**请求**
```
GET /api/cart/list
```

**请求头**
```
Authorization: Bearer <token>
```

**响应**
```json
{
  "errorCode": 0,
  "errorMsg": "success",
  "data": [
    {
      "id": 1,
      "userId": 123,
      "commodityId": 456,
      "commodityName": "iPhone 15 Pro",
      "commodityAvatar": "https://example.com/image.jpg",
      "price": 7999.00,
      "quantity": 2,
      "selected": true,
      "createTime": "2024-12-24T10:00:00",
      "updateTime": "2024-12-24T10:00:00"
    }
  ]
}
```

---

### 2. 添加商品到购物车

将商品添加到购物车。如果商品已存在，则增加数量。

**请求**
```
POST /api/cart/add
Content-Type: application/json
```

**请求体**
```json
{
  "commodityId": 456,
  "quantity": 1
}
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| commodityId | Long | 是 | 商品ID |
| quantity | Integer | 否 | 数量，默认1 |

**响应**
```json
{
  "errorCode": 0,
  "errorMsg": "success",
  "data": 1
}
```

**说明**
- `data` 返回新创建的购物车项ID
- 如果商品已在购物车中，则累加数量，返回已有的购物车项ID
- 需要校验商品是否存在、是否上架

---

### 3. 更新购物车项

更新购物车项的数量或选中状态。

**请求**
```
POST /api/cart/update
Content-Type: application/json
```

**请求体**
```json
{
  "id": 1,
  "quantity": 3,
  "selected": true
}
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | Long | 是 | 购物车项ID |
| quantity | Integer | 否 | 新数量（最小为1） |
| selected | Boolean | 否 | 是否选中 |

**响应**
```json
{
  "errorCode": 0,
  "errorMsg": "success",
  "data": true
}
```

**说明**
- `quantity` 和 `selected` 至少传一个
- 需要校验购物车项是否属于当前用户

---

### 4. 删除购物车项

删除单个购物车项。

**请求**
```
POST /api/cart/remove
Content-Type: application/json
```

**请求体**
```json
{
  "id": 1
}
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | Long | 是 | 购物车项ID |

**响应**
```json
{
  "errorCode": 0,
  "errorMsg": "success",
  "data": true
}
```

---

### 5. 删除已选商品

批量删除所有选中的购物车项。

**请求**
```
POST /api/cart/removeSelected
```

**响应**
```json
{
  "errorCode": 0,
  "errorMsg": "success",
  "data": true
}
```

**说明**
- 删除当前用户购物车中所有 `selected=true` 的项

---

### 6. 清空购物车

清空当前用户的所有购物车项。

**请求**
```
POST /api/cart/clear
```

**响应**
```json
{
  "errorCode": 0,
  "errorMsg": "success",
  "data": true
}
```

---

### 7. 全选/取消全选

设置所有购物车项的选中状态。

**请求**
```
POST /api/cart/selectAll
Content-Type: application/json
```

**请求体**
```json
{
  "selected": true
}
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| selected | Boolean | 是 | true=全选，false=取消全选 |

**响应**
```json
{
  "errorCode": 0,
  "errorMsg": "success",
  "data": true
}
```

---

### 8. 获取购物车数量

获取当前用户购物车中的商品总数量（用于显示角标）。

**请求**
```
GET /api/cart/count
```

**响应**
```json
{
  "errorCode": 0,
  "errorMsg": "success",
  "data": 5
}
```

**说明**
- 返回所有购物车项的 `quantity` 之和

---

## 错误码

| errorCode | 说明 |
|-----------|------|
| 0 | 成功 |
| 40001 | 参数错误 |
| 40100 | 未登录 |
| 40101 | 无权限（购物车项不属于当前用户） |
| 40400 | 商品不存在 |
| 40401 | 商品已下架 |
| 50000 | 系统错误 |

---

## 数据库表设计建议

```sql
CREATE TABLE `cart` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `commodity_id` BIGINT NOT NULL COMMENT '商品ID',
  `commodity_name` VARCHAR(255) NOT NULL COMMENT '商品名称',
  `commodity_avatar` VARCHAR(500) DEFAULT NULL COMMENT '商品图片',
  `price` DECIMAL(10,2) NOT NULL COMMENT '商品单价',
  `quantity` INT NOT NULL DEFAULT 1 COMMENT '数量',
  `selected` TINYINT(1) NOT NULL DEFAULT 1 COMMENT '是否选中：0-否，1-是',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0-否，1-是',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_commodity_id` (`commodity_id`),
  UNIQUE KEY `uk_user_commodity` (`user_id`, `commodity_id`, `is_deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='购物车表';
```

---

## 前端调用示例

```typescript
import { cartApi } from '@/api/cart'

// 获取购物车列表
const items = await cartApi.getList()

// 添加商品到购物车
await cartApi.add({ commodityId: 123, quantity: 2 })

// 更新数量
await cartApi.update({ id: 1, quantity: 5 })

// 切换选中状态
await cartApi.update({ id: 1, selected: false })

// 删除单个
await cartApi.remove(1)

// 删除已选
await cartApi.removeSelected()

// 清空购物车
await cartApi.clear()

// 全选
await cartApi.selectAll(true)

// 获取数量
const count = await cartApi.getCount()
```
